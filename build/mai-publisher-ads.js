(()=>{window.pbjs=window.pbjs||{que:[]},window.googletag=window.googletag||{},googletag.cmd=googletag.cmd||[];const e=maiPubAdsVars.ads,t=[],a=[],i=maiPubAdsVars.gamBase,o=maiPubAdsVars.gamBaseClient,s="refresh",n=maiPubAdsVars.targets.refresh,r={},d={},l=5e3,c=window.location.search.includes("dfpdeb")||window.location.search.includes("maideb")||window.location.search.includes("pbjs_debug=true"),g=maiPubAdsVars.debug,m=Boolean(maiPubAdsVars.consent),u=maiPubAdsVars.ppid,p=function(){let e=!1;return e=document.cookie.match(/(?:^|;)\s*maipub_consent=([^;]*)(?:;|$)/),e=!(!e||!e[1])&&e[1],e||(e=localStorage.getItem("maipub_consent")),Boolean(e)}(),b=function(){const e=M(),t=localStorage.getItem("maipub_ppid");return e||t||""}();let f=Date.now(),h=m||p,P="",S=!1,A=!1,v=!1,I=!1;if(R("v236"),u?(P=u,R(`Using server-side PPID: ${P}`)):b&&(P=b,R(`Using local PPID: ${P}`)),maiPubAdsVars.amazonUAM&&(function(e,t,a,i,o,s,n){function r(a,i){t[e]._Q.push([a,i])}t[e]||(t[e]={init:function(){r("i",arguments)},fetchBids:function(){r("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(s=a.createElement(i)).async=!0,s.src="//c.amazon-adsystem.com/aax2/apstag.js",(n=a.getElementsByTagName(i)[0]).parentNode.insertBefore(s,n))}("apstag",window,document,"script"),apstag.init({pubID:"79166f25-5776-4c3e-9537-abad9a584b43",adServer:"googletag",schain:{complete:1,ver:"1.0",nodes:[{asi:"bizbudding.com",sid:maiPubAdsVars.sellersId,hp:1,name:maiPubAdsVars.sellersName,domain:maiPubAdsVars.domain}]}})),maiPubAdsVars.magnite&&(maiPubAdsVars.ortb2.mobile=parseInt(maiPubAdsVars.ortb2.mobile),maiPubAdsVars.ortb2.privacypolicy=parseInt(maiPubAdsVars.ortb2.privacypolicy),maiPubAdsVars.ortb2.cattax=parseInt(maiPubAdsVars.ortb2.cattax),maiPubAdsVars.ortb2.content.cattax=parseInt(maiPubAdsVars.ortb2.content.cattax),pbjs.que.push((function(){const e={bidderTimeout:l,enableTIDs:!0,ortb2:maiPubAdsVars.ortb2,schain:{complete:1,ver:"1.0",nodes:[{asi:"bizbudding.com",sid:maiPubAdsVars.sellersId,hp:1,name:maiPubAdsVars.sellersName,domain:maiPubAdsVars.domain}]}};P&&(e.userSync={userIds:[{name:"pubProvidedId",params:{eids:[{source:maiPubAdsVars.domain,uids:[{id:P,atype:1}]}]}}]}),R("pbjsConfig",e),pbjs.setConfig(e)}))),"function"==typeof __tcfapi){const e=setTimeout((()=>{A||(R("CMP timeout, proceeding with initialization"),A=!0,y())}),2e3);try{__tcfapi("addEventListener",2,((t,a)=>{A||!t||"tcloaded"!==t.eventStatus&&"useractioncomplete"!==t.eventStatus||(A=!0,h=Boolean(a),clearTimeout(e),R(`CMP loaded, proceeding with initialization: ${a}`,t),y())}))}catch(t){R("CMP error:",t),clearTimeout(e),A=!0,y()}}else A=!0,y();if(maiPubAdsVars.matomo.enabled&&maiPubAdsVars.shouldTrack){const e=setTimeout((()=>{v||(R("Matomo timeout, proceeding with initialization"),v=!0,y())}),2e3);if(P)v=!0,clearTimeout(e),R(`Skipping Matomo initialization, using existing PPID: ${P}`),y();else if("undefined"!=typeof Matomo)try{const t=Matomo.getAsyncTracker();if(t){const a=t.getVisitorId();a&&D(a).then((t=>{P=t,v=!0,clearTimeout(e),R(`Matomo already initialized, generated PPID from visitor ID: ${P}`),y()})).catch((t=>{R("Error generating PPID from Matomo visitor ID:",t),D().then((t=>{P=t,v=!0,clearTimeout(e),R(`Matomo already initialized, generated random PPID after generation error: ${P}`),y()}))}))}}catch(t){R("Error accessing Matomo:",t),D().then((t=>{P=t,v=!0,clearTimeout(e),R(`Matomo already initialized, generated random PPID after catching error: ${P}`),y()}))}else R("Matomo not initialized, waiting for analytics init event"),document.addEventListener("maiPublisherAnalyticsInit",(function(t){D(t.detail.tracker.getVisitorId()).then((t=>{P=t,v=!0,clearTimeout(e),R(`Matomo async event fired, generated PPID from visitor ID: ${P}`),y()}))}),{once:!0})}else v=!0,maiPubAdsVars.matomo.enabled?maiPubAdsVars.shouldTrack||R("Matomo enabled but should not track"):R("Matomo disabled"),y();function y(){if(!A&&"function"==typeof __tcfapi||!v&&maiPubAdsVars.matomo.enabled){const e=[];return A||"function"!=typeof __tcfapi||e.push("CMP"),!v&&maiPubAdsVars.matomo.enabled&&e.push("Matomo"),void R("GAM not initialized, waiting for "+e.join(" and "))}P?(R(`Initializing GAM with ppid: ${P}`),V()):D().then((e=>{P=e,R(`Generated random PPID: ${P}`),R(`Initializing GAM with ppid: ${P}`),V()}))}function V(){if(h===m&&h===p||function(e){R(`Storing consent in cookie and session storage: ${e}`),document.cookie=`maipub_consent=${e};path=/;max-age=31104000;SameSite=Lax;Secure`,localStorage.setItem("maipub_consent",e)}(h),!P||P===u&&b&&P===b||function(e){h?(R(`Storing PPID in cookie: ${e}`),document.cookie=`maipub_ppid=${e};path=/;max-age=31104000;SameSite=Lax;Secure`):M()&&(R("No consent, removing PPID from cookie"),document.cookie="maipub_ppid=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT;SameSite=Lax;Secure"),R(`Storing PPID in session storage: ${e}`),localStorage.setItem("maipub_ppid",e)}(P),maiPubAdsVars.dcSeg){const e=document.createElement("script");e.async=!0,e.id="google-pcd-tag",e.className="mai-pcd-tag",e.src="https://pagead2.googlesyndication.com/pagead/js/pcd.js";let t="";maiPubAdsVars.dcSeg.forEach((e=>{t+=`dc_seg=${e};`}));let a=`dc_iu=/${maiPubAdsVars.bbNetworkCode}/DFPAudiencePixel;${t}gd=${maiPubAdsVars.domainHashed}`;P&&(a+=`;ppid=${P}`),e.setAttribute("data-audience-pixel",a),document.head.appendChild(e)}maiPubAdsVars.loadDelay?window.addEventListener("load",(()=>{setTimeout(w,maiPubAdsVars.loadDelay)}),{once:!0}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",w,{once:!0}):w()}function w(){const e=new IntersectionObserver(((e,t)=>{const a=[],i=[];e.forEach((e=>{const o=e.target.getAttribute("id"),s=o.replace("mai-ad-","");e.isIntersecting?(r[o].visible=!0,I?i.push(s):a.push(s),c&&(e.target.style.outline="2px dashed red",e.target.setAttribute("data-label",s)),t.unobserve(e.target)):r[o].visible=!1})),a.length&&googletag.cmd.push((()=>{a.forEach((e=>{T(e),googletag.display("mai-ad-"+e)})),googletag.enableServices(),I=!0,z(a)})),i.length&&googletag.cmd.push((()=>{i.forEach((e=>{T(e),googletag.display("mai-ad-"+e)})),z(i)}))}),{root:null,rootMargin:"600px 0px 600px 0px",threshold:0});googletag.cmd.push((()=>{const e=[...new Set([maiPubAdsVars.iabGlobalCat,maiPubAdsVars.iabCat].filter((e=>e)))];e.length&&googletag.setConfig({pps:{taxonomies:{IAB_CONTENT_2_2:{values:e}}}}),googletag.pubads().disableInitialLoad(),googletag.pubads().enableSingleRequest(),googletag.pubads().setCentering(!0),P&&(R("Setting googletag PPID:",P),googletag.pubads().setPublisherProvidedId(P)),maiPubAdsVars.targets&&(Object.keys(maiPubAdsVars.targets).forEach((e=>{googletag.pubads().setTargeting(e,maiPubAdsVars.targets[e].toString())})),R("Set page-level targeting from:",maiPubAdsVars.targets))})),googletag.cmd.push((()=>{document.querySelectorAll(".mai-ad-unit").forEach((t=>{const a=t.getAttribute("id");r[a]={processing:!1,visible:null,lastRefreshTime:0,firstRender:!0},e.observe(t)}))})),googletag.cmd.push((()=>{googletag.pubads().addEventListener("slotRenderEnded",(e=>{const t=e.slot;if(!E(t))return void R(`Slot ${t.getSlotElementId()} is not a Mai Publisher slot, via slotRenderEnded`);const a=t.getSlotElementId(),i=a.replace("mai-ad-","");r[a].lastRefreshTime=Date.now(),r[a].processing=!1,e.isEmpty?R(`Slot empty: ${a}`,{slug:i,adUnitPath:t.getAdUnitPath(),sizes:e.size,targeting:t.getTargetingMap(),event:e}):R(`Slot filled: ${a}`,{slug:i,adUnitPath:t.getAdUnitPath(),sizes:e.size,targeting:t.getTargetingMap(),event:e}),$(t)&&(d[a]=setTimeout((()=>{z([i])}),32e3))})),googletag.pubads().addEventListener("slotVisibilityChanged",(e=>{const t=e.slot;if(!E(t))return void R(`Slot ${t.getSlotElementId()} is not a Mai Publisher slot, via slotVisibilityChanged`);if(!$(t))return;const a=t.getSlotElementId(),i=a.replace("mai-ad-",""),o=e.inViewPercentage>5;r[a].visible=o,o&&z([i])}))}))}function T(r){const d=e?.[r]?.context&&"client"===e[r].context?o:i,l="mai-ad-"+r,c=d+e[r].id;googletag.cmd.push((()=>{const i=googletag.defineSlot(c,e[r].sizes,l);i.addService(googletag.pubads()),i.setTargeting(s,n),e[r].targets&&Object.keys(e[r].targets).forEach((t=>{i.setTargeting(t,e[r].targets[t])})),e[r].splitTest&&"rand"===e[r].splitTest&&i.setTargeting("st",Math.floor(100*Math.random())),i.defineSizeMapping(googletag.sizeMapping().addSize([1024,768],e[r].sizesDesktop).addSize([728,480],e[r].sizesTablet).addSize([0,0],e[r].sizesMobile).build()),R(`Defined slot: ${l} via ${c}`,{gamId:c,slot:i,targets:i.getTargetingMap()}),t.push(c),a.push(i)}))}function z(t){googletag.cmd.push((()=>{const o=Date.now(),s=t.map((e=>a.find((t=>"mai-ad-"+e===t.getSlotElementId())))).filter((e=>{if(!e)return R(`Warning: Slot object not found for slug ${slug} during request check.`),!1;const t=e.getSlotElementId();if(r[t].firstRender)return R(`First request for ${t}`),!0;if(r[t].processing)return!1;if(!r[t].visible)return clearTimeout(d[t]),delete d[t],!1;if(r[t].lastRefreshTime){if(o-r[t].lastRefreshTime<32e3)return!1;R(`Requesting slot ${t} - ${Math.round((o-r[t].lastRefreshTime)/1e3)} seconds since the last refresh`)}return!0}));s.length&&function(t){t.forEach((e=>{const t=e.getSlotElementId();r[t].processing=!0,clearTimeout(d[t]),delete d[t]})),R(`Requesting slots: ${t.map((e=>e.getSlotElementId())).join(", ")}`);const a={adserverRequestSent:!1,prebidBidsReceived:!maiPubAdsVars.magnite,amazonBidsReceived:!maiPubAdsVars.amazonUAM},o=function(){a.adserverRequestSent?R("Adserver request already sent, skipping. State:",{prebidBidsReceived:a.prebidBidsReceived,amazonBidsReceived:a.amazonBidsReceived,slots:t.map((e=>e.getSlotElementId()))}):googletag.cmd.push((()=>{a.adserverRequestSent=!0,R(`Sending adserver request: ${t.map((e=>e.getSlotElementId())).join(", ")}`),function(e){googletag.cmd.push((()=>{e.forEach((e=>{const t=e.getSlotElementId();r[t].firstRender=!1})),R(`Displaying/refreshing ${e.length} ${1===e.length?"slot":"slots"} via refresh(): ${e.map((e=>e.getSlotElementId())).join(", ")}`),googletag.pubads().refresh(e,{changeCorrelator:!1})}))}(t)}))};if(maiPubAdsVars.magnite&&pbjs.que.push((function(){const e=Date.now();pbjs.rp.requestBids({gptSlotObjects:t,timeout:l,callback:function(i,s,n){googletag.cmd.push((()=>{pbjs.setTargetingForGPTAsync&&pbjs.setTargetingForGPTAsync(t.map((e=>e.getSlotElementId()))),a.prebidBidsReceived=!0,R(`Prebid response time: ${Date.now()-e}ms`,{bids:i,timedOut:s,auctionId:n}),a.amazonBidsReceived&&(R("Sending adserver request via Prebid bids"),o())}))}})})),maiPubAdsVars.amazonUAM){const s=t.filter((t=>{const a=t.getSlotElementId().replace("mai-ad-","");return!(1===e[a].sizes.length&&"fluid"===e[a].sizes[0])&&"client"!==e[a].context})).map((t=>{const a=t.getSlotElementId(),o=a.replace("mai-ad-","");return{slotID:a,slotName:i+e[o].id,sizes:e[o].sizes}}));if(s.length){const e={slots:s,timeout:l,params:{adRefresh:"1"}};R("amazonConfig",e);const t=Date.now();apstag.fetchBids(e,(function(e){googletag.cmd.push((()=>{R(`Amazon response time: ${Date.now()-t}ms`,e),apstag.setDisplayBids(),a.amazonBidsReceived=!0,a.prebidBidsReceived&&(R(`Sending adserver request via amazon: ${s.map((e=>e.slotID.replace("mai-ad-",""))).join(", ")}`,s),o()),(c||g)&&e.forEach((e=>{e.error&&R("apstag.fetchBids error:",e)}))}))}))}else a.amazonBidsReceived=!0,a.prebidBidsReceived&&(R(`Sending adserver request without amazon slots to fetch: ${t.map((e=>e.getSlotElementId())).join(", ")}`,t),o())}maiPubAdsVars.magnite&&maiPubAdsVars.amazonUAM||(R(`Sending adserver request with GAM: ${t.map((e=>e.getSlotElementId())).join(", ")}`,t),o()),setTimeout((()=>{a.adserverRequestSent||(R("refresh() with failsafe timeout. Debug data:",{adserverRequestSent:a.adserverRequestSent,prebidBidsReceived:a.prebidBidsReceived,amazonBidsReceived:a.amazonBidsReceived,timing:{totalTime:Date.now()-f,bidderTimeout:l,fallbackTimeout:6e3}}),o())}),6e3)}(s)}))}function E(e){return e&&t.includes(e.getAdUnitPath())}function $(e){return e&&Boolean(e.getTargeting(s).shift())}async function D(e=""){if(S)return new Promise((e=>{const t=setInterval((()=>{S||(clearInterval(t),e(P))}),100)}));S=!0;try{let t=String(e||"");if(!t){if(!window.crypto||!window.crypto.subtle)throw new Error("Web Crypto API not available");t="function"==typeof crypto.randomUUID?crypto.randomUUID():Array.from(crypto.getRandomValues(new Uint8Array(16))).map((e=>e.toString(16).padStart(2,"0"))).join("")}const a=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}catch(e){return R("Error transforming ppid:",e),null}finally{S=!1}}function M(){const e=document.cookie.match(/(?:^|;)\s*maipub_ppid=([^;]*)(?:;|$)/);return e?.[1]||""}function R(...e){if(!c&&!g)return;let t="maipub ";const a=Date.now(),i=(new Date).toLocaleTimeString("en-US",{hour12:!0});t+=f===a?"start":a-f+"ms",console.log(`${t} ${i}`,e)}})();
//# sourceMappingURL=mai-publisher-ads.js.map