(()=>{window.pbjs=window.pbjs||{que:[]},window.googletag=window.googletag||{},googletag.cmd=googletag.cmd||[];const e=maiPubAdsVars.ads,t=[],a=[],i=maiPubAdsVars.gamBase,s=maiPubAdsVars.gamBaseClient,o="refresh",d=maiPubAdsVars.targets.refresh,n={},r={},l={},c=3e3,u=4e3,m=window.location.search.includes("dfpdeb")||window.location.search.includes("maideb")||window.location.search.includes("pbjs_debug=true"),g=maiPubAdsVars.debug,p={prebid:{},amazon:{},timeouts:[]};let b=Date.now(),f="",h=!1,v=!1;if(E("v207"),maiPubAdsVars.amazonUAM&&(function(e,t,a,i,s,o,d){function n(a,i){t[e]._Q.push([a,i])}t[e]||(t[e]={init:function(){n("i",arguments)},fetchBids:function(){n("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(o=a.createElement(i)).async=!0,o.src="//c.amazon-adsystem.com/aax2/apstag.js",(d=a.getElementsByTagName(i)[0]).parentNode.insertBefore(o,d))}("apstag",window,document,"script"),apstag.init({pubID:"79166f25-5776-4c3e-9537-abad9a584b43",adServer:"googletag",schain:{complete:1,ver:"1.0",nodes:[{asi:"bizbudding.com",sid:maiPubAdsVars.sellersId,hp:1,name:maiPubAdsVars.sellersName,domain:maiPubAdsVars.domain}]}})),"function"==typeof __tcfapi){const e=setTimeout((()=>{h||(E("CMP timeout, proceeding with initialization"),h=!0,A())}),1500);try{__tcfapi("addEventListener",2,((t,a)=>{h||!t||"tcloaded"!==t.eventStatus&&"useractioncomplete"!==t.eventStatus||(h=!0,clearTimeout(e),E("CMP loaded, proceeding with initialization",a,t),A())}))}catch(t){E("CMP error:",t),clearTimeout(e),h=!0,A()}}else h=!0,A();if(maiPubAdsVars.matomo.enabled&&maiPubAdsVars.shouldTrack){const e=setTimeout((()=>{v||(E("Matomo timeout, proceeding with initialization"),v=!0,A())}),3e3);"undefined"!=typeof Matomo?(f||(f=Matomo.getAsyncTracker().getVisitorId()),v=!0,clearTimeout(e),E(`Matomo already initialized, visitorId: ${f}`),A()):(E("Matomo not initialized, waiting for analytics init event"),document.addEventListener("maiPublisherAnalyticsInit",(function(t){f||(f=t.detail.tracker.getVisitorId()),v=!0,clearTimeout(e),E(`Matomo async event fired, visitorId: ${f}`),A()}),{once:!0}))}else v=!0,E("Matomo tracking disabled"),A();function A(){if(!h&&"function"==typeof __tcfapi||!v&&maiPubAdsVars.matomo.enabled){const e=[];return h||"function"!=typeof __tcfapi||e.push("CMP"),!v&&maiPubAdsVars.matomo.enabled&&e.push("Matomo"),void E("GAM not initialized, waiting for "+e.join(" and "))}f=localStorage.getItem("maiPubVisitorId"),f||(f=Math.random().toString(36).substring(2,10)+Date.now().toString(36).substring(2,10),localStorage.setItem("maiPubVisitorId",f)),E(`Initializing GAM with visitorId: ${f}`),function(){if(maiPubAdsVars.dcSeg){const e=document.createElement("script");e.async=!0,e.id="google-pcd-tag",e.className="mai-pcd-tag",e.src="https://pagead2.googlesyndication.com/pagead/js/pcd.js";let t="";maiPubAdsVars.dcSeg.forEach((e=>{t+=`dc_seg=${e};`}));let a=`dc_iu=/${maiPubAdsVars.bbNetworkCode}/DFPAudiencePixel;${t}gd=${maiPubAdsVars.domainHashed}`;f&&(a+=`;ppid=${f};`),e.setAttribute("data-audience-pixel",a),document.head.appendChild(e)}googletag.cmd.push((()=>{maiPubAdsVars.targets&&Object.keys(maiPubAdsVars.targets).forEach((e=>{googletag.pubads().setTargeting(e,maiPubAdsVars.targets[e].toString())})),googletag.pubads().setCentering(!0),googletag.pubads().disableInitialLoad(),googletag.pubads().enableSingleRequest(),f&&(E("Setting googletag PPID:",f),googletag.pubads().setPublisherProvidedId(f)),googletag.enableServices(),maiPubAdsVars.loadDelay?window.addEventListener("load",(()=>{setTimeout(P,maiPubAdsVars.loadDelay)}),{once:!0}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",P,{once:!0}):P(),googletag.pubads().addEventListener("impressionViewable",(e=>{const t=e.slot,a=t.getSlotElementId();y(t)&&(n[a]=Date.now(),l[a]&&clearTimeout(l[a]),l[a]=setTimeout((()=>{E("refreshed via impressionViewable: "+a,t),z([t])}),3e4))})),googletag.pubads().addEventListener("slotVisibilityChanged",(e=>{const t=e.slot,a=t.getSlotElementId(),i=e.inViewPercentage>5;if(y(t)){if(i&&!r[a])r[a]=!0;else{if(i||!r[a])return;r[a]=!1}r[a]?!n?.[a]||n[a]&&Date.now()-n[a]<3e4||(E("refreshed via slotVisibilityChanged: "+a,t),z([t])):clearTimeout(l[a])}})),googletag.pubads().addEventListener("slotRenderEnded",(t=>{if(!t.isEmpty)return;if(!V(t.slot))return;const a=t.slot.getSlotElementId().replace("mai-ad-","");e[a].context})),(m||g)&&(googletag.pubads().addEventListener("slotRequested",(e=>{E("slotRequested:",e.slot,e)})),googletag.pubads().addEventListener("slotResponseReceived",(e=>{E("slotResponseReceived:",e.slot,e)})),googletag.pubads().addEventListener("slotOnload",(e=>{E("slotOnload:",e.slot,e)})),googletag.pubads().addEventListener("slotRenderEnded",(e=>{E("slotRenderEnded:",e.slot,e)})))}))}()}function P(){const e=[],t=document.querySelectorAll('.mai-ad-unit[data-ap="atf"], .mai-ad-unit[data-ap="bs"]'),a=document.querySelectorAll('.mai-ad-unit:not([data-ap="atf"]):not([data-ap="bs"])');googletag.cmd.push((()=>{t.forEach((t=>{const a=t.getAttribute("id").replace("mai-ad-","");e.push(w(a)),m&&(t.style.outline="2px dashed limegreen",t.setAttribute("data-label",a))})),e.length&&S(e)}));const i=new IntersectionObserver(((e,t)=>{const a=[];e.forEach((e=>{if(!e.isIntersecting)return;const i=e.target.getAttribute("id").replace("mai-ad-","");m&&(e.target.style.outline="2px dashed red",e.target.setAttribute("data-label",i)),a.push(i),t.unobserve(e.target)})),a.length&&googletag.cmd.push((()=>{S(a.map((e=>w(e))))}))}),{root:null,rootMargin:"600px 0px 600px 0px",threshold:0});a.forEach((e=>{i.observe(e)}))}function w(n){let r=null;const l=(e?.[n]?.context&&"client"===e[n].context?s:i)+e[n].id,c="mai-ad-"+n,u=a.find((e=>c==e.getSlotElementId()));if(u)return E("Slot already defined:",u),u;const m=googletag.defineSlot(l,e[n].sizes,"mai-ad-"+n);return googletag.display("mai-ad-"+n),t.push(l),a.push(m),E("defineSlot() & display():",a),m.setTargeting(o,d),e[n].targets&&Object.keys(e[n].targets).forEach((t=>{m.setTargeting(t,e[n].targets[t])})),e[n].splitTest&&"rand"===e[n].splitTest&&m.setTargeting("st",Math.floor(100*Math.random())),m.addService(googletag.pubads()),m.defineSizeMapping(googletag.sizeMapping().addSize([1024,768],e[n].sizesDesktop).addSize([728,480],e[n].sizesTablet).addSize([0,0],e[n].sizesMobile).build()),r=m,r}function S(t){const a={adserverRequestSent:!1,dmBidsReceived:!1,apsBidsReceived:!1},s=function(){a.adserverRequestSent||(a.adserverRequestSent=!0,googletag.pubads().refresh(t))};if(maiPubAdsVars.magnite?(maiPubAdsVars.ortb2.mobile=parseInt(maiPubAdsVars.ortb2.mobile),maiPubAdsVars.ortb2.privacypolicy=parseInt(maiPubAdsVars.ortb2.privacypolicy),maiPubAdsVars.ortb2.cattax=parseInt(maiPubAdsVars.ortb2.cattax),maiPubAdsVars.ortb2.content.cattax=parseInt(maiPubAdsVars.ortb2.content.cattax),pbjs.que.push((function(){const e={bidderTimeout:c,enableTIDs:!0,ortb2:maiPubAdsVars.ortb2};f&&(e.userSync={userIds:[{name:"pubProvidedId",params:{eids:[{source:maiPubAdsVars.domain,uids:[{id:f,atype:1}]}]}}]}),E("pbjsConfig",e),pbjs.setConfig(e),pbjs.onEvent("bidResponse",(function(e){p.prebid[e.bidder]={value:e.cpm,size:e.size,adUnitCode:e.adUnitCode,timeToRespond:e.timeToRespond+"ms"},E("Prebid bid received from "+e.bidder,e)})),pbjs.onEvent("bidTimeout",(function(e){e.forEach((e=>{p.timeouts.push({bidder:e.bidder,adUnitCode:e.adUnitCode,timeout:c+"ms"})})),E("Bid timeout occurred:",e)})),pbjs.onEvent("allBidsBack",(function(e){E("All bids back:",{bids:e,timeouts:p.timeouts,timing:{totalTime:Date.now()-b+"ms",bidderTimeout:c+"ms",fallbackTimeout:u+"ms"}})})),pbjs.rp.requestBids({gptSlotObjects:t,callback:function(){pbjs.setTargetingForGPTAsync(),a.dmBidsReceived=!0,E("All prebid responses:",p.prebid),a.apsBidsReceived&&(s(),E("refresh() with prebid: "+t.map((e=>e.getSlotElementId())).join(", "),t))}})}))):a.dmBidsReceived=!0,maiPubAdsVars.amazonUAM){const o=t.filter((t=>{const a=t.getSlotElementId().replace("mai-ad-","");return!(1===e[a].sizes.length&&"fluid"===e[a].sizes[0])&&"client"!==e[a].context})).map((t=>{const a=t.getSlotElementId(),s=a.replace("mai-ad-","");return{slotID:a,slotName:i+e[s].id,sizes:e[s].sizes}}));if(o.length){const e={slots:o,timeout:c,params:{adRefresh:"1"}};E("amazonConfig",e);const t=Date.now();apstag.fetchBids(e,(function(e){const i=Date.now()-t;E("Amazon response time:",i+"ms"),e.forEach((e=>{p.amazon[e.slotID]={value:e.amznbid,size:e.size,responseTime:i+"ms",error:e.error||null}})),E("Amazon bids received:",p.amazon),apstag.setDisplayBids(),a.apsBidsReceived=!0,a.dmBidsReceived&&(s(),E("refresh() with amazon fetch: "+o.map((e=>e.slotID.replace("mai-ad-",""))).join(", "),o)),(m||g)&&e.forEach((e=>{e.error&&E("apstag.fetchBids error:",e)}))}))}else t.length&&(a.apsBidsReceived=!0,a.dmBidsReceived&&(s(),E("refresh() without amazon slots to fetch: "+t.map((e=>e.getSlotElementId())).join(", "),t)))}else{if(!t.length)return;a.apsBidsReceived=!0,a.dmBidsReceived&&s(),E("refresh() with GAM:"+t.map((e=>e.getSlotElementId())).join(", "),t)}setTimeout((()=>{const e={adserverRequestSent:a.adserverRequestSent,dmBidsReceived:a.dmBidsReceived,apsBidsReceived:a.apsBidsReceived,prebidBids:p.prebid,amazonBids:p.amazon,timeouts:p.timeouts,timing:{totalTime:Date.now()-b,bidderTimeout:c,fallbackTimeout:u}};a.adserverRequestSent||E("refresh() with failsafe timeout. Debug data:",e),s()}),u)}function V(e){return e&&t.includes(e.getAdUnitPath())}function y(e){return V(e)&&Boolean(e.getTargeting(o).shift())}function z(e){maiPubAdsVars.amazonUAM&&(E("setDisplayBids via apstag: "+e.map((e=>e.getSlotElementId())).join(", "),e),apstag.setDisplayBids()),googletag.pubads().refresh(e,{changeCorrelator:!1})}function E(...e){if(!m&&!g)return;let t="maipub ";const a=Date.now(),i=(new Date).toLocaleTimeString("en-US",{hour12:!0});t+=b===a?"start":a-b+"ms",console.log(`${t} ${i}`,e)}})();
//# sourceMappingURL=mai-publisher-ads.js.map